<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wind and Altimetry Tracker</title>
    <style>
        body {
            height: 100vh;
            display: flex;
            color: white;
            background-color: rgb(184, 188, 204) 0.2;
            font-family: Arial, sans-serif;
        }

        #text {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.2em;
            transition: transform 1s ease;
        }

        #info-panel {
            position: absolute;
            width: 40vw;
            padding-left: 20px;
            padding-bottom: 0px;
            background: transparent;
            font-size: 14px;
            font-weight: 300;
            line-height: 1.4;
            overflow-y: auto; 
            max-height: 100vh;
            opacity: 100%;
            scrollbar-width: none;
            color: rgb(34, 58, 165);
            justify-content: center;
            align-items: center;
            filter: blur(0.5px);
            transition: 3s ease-in-out;
        }

        #info-panel:hover {
            filter: blur(0px);
            transition: 1s ease-in-out;
        }

        .horizontal-line {
            position: absolute;
            width: calc(100% - 40px);
            height: 3px;
            left: 20px;
            top: 60%; /* Default position; will be adjusted dynamically */
            background: rgb(34, 58, 165);
            z-index: 1;
            transition: top 1s ease, background 0.5s ease;
        }

        .stable-line-1 {
            position: absolute;
            width: calc(100% - 40px);
            height: 1px;
            top: 50%;
            left: 20px;
            border-top: 2px dotted rgb(34, 58, 165);
            z-index: 0;
            filter: blur(0.5px);
        }


        @media (max-width: 768px) {
            #info-panel {
                width: 85vw;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="info-panel">
        <p id="text"> </p>
        <p id="altimetry">Altitude: Not available</p>
    </div>
    <div id="lines">
        <div class="horizontal-line" id="altitude-line"></div>
        <div class="stable-line-1"></div>
    </div>

    <script>
        const apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=51.9225&longitude=4.4792&current=wind_speed_10m,wind_direction_10m&hourly=temperature_2m&timezone=Europe%2FBerlin';

        // Fetch wind data
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const windSpeed = data.current.wind_speed_10m;
                const windDirection = data.current.wind_direction_10m;
                const windDirectionText = convertWindDirection(windDirection);

                document.getElementById("text").innerHTML = `At the moment <span style="text-decoration: underline;">the wind is blowing ${windSpeed} m/s from ${windDirectionText}.</span>`;
            })
            .catch(error => {
                console.error('Error fetching wind data:', error);
            });

        // Geolocation to track altitude
        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition(
                (position) => {
                    const { altitude } = position.coords;
                    const altitudeText = altitude !== null
                        ? `${altitude.toFixed(2)} meters`
                        : "Altitude data not available";

                    document.getElementById("altimetry").textContent = `Altitude: ${altitudeText}`;

                    // Update the horizontal line's position
                    if (altitude !== null) {
                        moveHorizontalLine(altitude);
                    }
                },
                (error) => {
                    console.error("Geolocation error:", error.message);
                    document.getElementById("altimetry").textContent = "Error fetching altitude.";
                },
                { enableHighAccuracy: true }
            );
        } else {
            document.getElementById("altimetry").textContent = "Geolocation not supported.";
        }

        // Convert wind direction degrees to text
        function convertWindDirection(degrees) {
            if (degrees >= 0 && degrees < 22.5) return "North (N)";
            if (degrees >= 22.5 && degrees < 67.5) return "North-East (NE)";
            if (degrees >= 67.5 && degrees < 112.5) return "East (E)";
            if (degrees >= 112.5 && degrees < 157.5) return "South-East (SE)";
            if (degrees >= 157.5 && degrees < 202.5) return "South (S)";
            if (degrees >= 202.5 && degrees < 247.5) return "South-West (SW)";
            if (degrees >= 247.5 && degrees < 292.5) return "West (W)";
            if (degrees >= 292.5 && degrees < 337.5) return "North-West (NW)";
            return "North (N)";
        }

        // Move horizontal line based on altitude
        function moveHorizontalLine(altitude) {
            const line = document.getElementById("altitude-line");
            const maxAltitude = 2000; // Example maximum altitude to normalize movement
            const normalizedAltitude = Math.min(altitude, maxAltitude) / maxAltitude; // Ensure range is between 0-1
            const newTop = 100 + (1 - normalizedAltitude) * (window.innerHeight - 200); // Map altitude to screen height
            line.style.top = `${newTop}px`;

            // Change color as altitude increases
            const redIntensity = Math.min(255, Math.floor(normalizedAltitude * 255));
            line.style.background = `rgb(${redIntensity}, 58, 165)`;
        }
    </script>
</body>
</html>

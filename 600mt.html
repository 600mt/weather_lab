<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>600mt</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Basic styling */
    body {
      display: flex;
      margin: 0;
      font-family: Arial, sans-serif;
      
    }
    #chart-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      width: calc(100vw - 300px); /* Account for the info panel width */
      height: 100vh;              /* Full viewport height */
      background: #ffffff; 
    }

    #info {
      margin:0;
    }

    #close {
      display:none;
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 7px 15px;
      border-radius: 25px;
      cursor: pointer;
      z-index: 1000;
      background: transparent;
      box-shadow: none;
    }

    #info-panel {
      position: fixed;
      width: 30vw;
      padding-left: 20px;
      padding-bottom: 0px;
      background: transparent;
      border-left: 1px solid #ddd;
      font-family: times;
      font-size: 15px;
      line-height: 1.4;
      overflow-y: auto; 
      max-height: 100vh;
      opacity: 100%;
      scrollbar-width: none; /* for Firefox */
      color:#000000;
    }

    #info-panel h2 {
      margin-top: 0;
    }
    /* Style for images */
    .node-image {
      width: 100%;
      max-width: 100%;
      margin-top: 5px;
    }

      /* Style for labels */
  text {
    transition: font-size 0.4s ease; /* Smooth transition on hover */
  }

  text:hover {
    font-size: calc(19px + 2px); /* Increase font size by 2px on hover */
  }

@media (max-width: 768px) {
  #info-panel {
    width: 95vw; /* Increase width on mobile */
    font-size: 15px; /* Smaller font size for mobile */
    padding: 10px; /* Less padding on mobile */
    position: fixed;
    top: 0; /* Stick to the top of the viewport */
    z-index: 10; /* Ensure it stays above other elements */
    line-height: 1.2em;
    background-color: transparent;
    opacity:97%;
  }

  #chart-container {
    width: 100vw; /* Full width */
    height: 80vh; /* Adjust height to leave room for the info panel */
    align-items: center;
  }

  svg {
    width: 100%;
    height: 100%;
  }

  text:hover {
    font-size: 50px; /* Increase font size by 2px on hover */
  }

  #close {
      display:none;
      position: fixed;
      top: 80vh;
      left:20px;
      right: 20px;
      padding: 7px 15px;
      border-radius: 25px;
      cursor: pointer;
      z-index: 1000;
      background: transparent;
      box-shadow: none;
    }


}

  </style>
</head>
<body>
  <div id="info-panel">
    <p> 600mt is a graphic design practice with a focus on mapping information within spatial contexts. </p>
    <p id="info"> <br> 
  <div>  <button id="close"> Close</button> </div>
    <!-- <p id="info"> -------------------------- <br>
    Click and drag the nodes to see details here. <br> The nodes of this color are loose categories, drag them and see which project follows </p> -->
    <div id="images"></div> <!-- Container for images -->
  </div>
  <div id="chart-container">
    <svg viewBox="0 0 928 600" preserveAspectRatio="xMidYMid meet" style="width:100vw; height: 100vh;"></svg> <!-- Updated SVG attributes -->
  </div>


  <script>
    
    // Data with nodes and links, assigning each node a specific category
    const data = {
      nodes: [
      {id: "Ecology", group: "print", category: "d"},
      {id: "Image Making", group: "print", category: "d"},
      {id: "Diagrams", group: "print", category: "d"},
      {id: "Geography", group: "print", category: "d"},
      {id: "Archive Digging", group: "print", category: "d"},

        {id: "Spitze Ohne Name", group: "print", category: "v",                     description: "Names reflect, but also shape, the ways in which we relate to and think about the living world. The Italo- Swiss Monte Rosa massif, given its height, was for centuries one of the most inaccessible and therefore unknown and nameless places on the European continent: today it is decorated on maps with hundreds of names that seek to define and enclose it. A toponymy map of this area will guide you through the slow and surprisingly recent recognition and conquest of the high mountain, examining a situated case of how man relates to the unknown."},
        {id: "Strategic Futures", group: "installation-performance", category: "v", description: "By strategic futures, also referred to as critical futures, is meant future prospects and narratives essential for economic and national security, but based on a limited supply with no known alternatives. A series of documents recounts the procedure undertaken by the company Strategic Minerals to obtain authorisation to search for cobalt-silver and associated minerals at the former ‘Punta Corna’ mine site in north-western Italy. Through a comparison of the presented contents of the company, oriented towards sustainability and so-called green energy, and those of a number of local archaeological and environmental protection associations that would like the work to be suspended, the current European strategy regarding the extraction of critical minerals and a broader reflection on global mining exploitation are presented.The use of a wood board, a tipical comunication media present in the alps area to release official information to citizen and general public, remind the geographical and cultural context this story is taking place and exist as an hybrid between an hiking informative board (side with map) and an official burocratic wall to hang documents."},
        {id: "A great place for a ride", group: "video", category: "v",             description: "Miguel, a fictional motorbike enthusiast born and raised close to the forest of Leiria in Portugal, is sharing his personal knowledge, built from google maps comments and an offline interview, about this place, while riding his quad among the trees. The national forest of Leiria, known for its beauty, unspoilt nature and place for leisure activities, between the lines of his personal story, hides traces of a lucrative and artificial past. The overview described by Miguel is built around three main recurrent topics, that take shapes in three different chapters: [the sand-the greatness] the origin of the forest, planted by the king to defend the inner countryside and the people; [the fires-the beauty] the fires happening today, a dramatic but obvious consequence, for Miguel, of corrupted politics; [the wood-the pride] the wood and its usage through history for ship-caravels building. All these narratives make the forest a national pride to defend, but in the end today, for Miguel, is just a playground for his rides."},
        {id: "A cloud of clouds by clouds", group: "web-site", category: "v",       description: "During the 17th century, Dutch painters began emphasizing the sky in their work, dedicating almost the entire height of their canvases to its depiction. This newfound fascination with the sky coincided with the first cloud nomenclature, introduced in 1802. At the time, cloudscape paintings served as rudimentary meteorological data. The Depot Boijmans Van Beuningen in Rotterdam, a partner in this project, houses hundreds of such artworks. However, these treasures remain largely hidden from view. Ironically, what visitors consistently see is the sky and clouds reflected on the Depot’s mirrored facade. Cloud of Clouds by Clouds offers an alternative way to explore the Depot’s hidden cloudscape collection. This “cloud” platform curates cloud paintings filtered by the real-time presence of clouds above the Depot. It serves both as an instant weather visualization tool and as an ever-evolving online exhibition, constantly shaped by the shifting skies."},
        {id: "The Gas Route", group: "book", category: "m",                         description: "In Europe since almost fifty years natural gas has been an invisible and necessary resource arriving at people’s home from an undefined somewhere; today the different political meanings that gas infrastructure gained on one hand exposed part of its geographical existence, but on the other abstracted it as an object existing at various distances and scales, impossible to grasp. Its distribution takes place beneath our feet through a tangible network of pipes that cross borders and territories and shape landscapes and politics, but it magically disappears from sight and perception. This text aims at understanding how the process of hiding this infrastructure in plain sight has occurred throughout time using cartographic artifacts released by one of the biggest oil&gas state- owned company in europe, Eni. These graphic materials will expose the ever changing desires and hopes around the issue of gas: from the celebration of this new resource as an ecological breakthrough to substitute other fossil fuels to today’s times when gas eventually became a key resource we depend on and that we already find outdated."},
        {id: "Il signore che viene da lontano", group: "video", category: "v",      description: "In 1973, the Italian company Eni buried a 900-kilometer-long pipe between Italy and the Netherlands to import natural gas, promising clean and endless energy to fuel industry and replace oil. Over fifty years later, this oversized object remains unnoticed, marked only by ground poles and empty spaces. Informed by multiple-scale observational research including satellite images, Street View, photographic archival material, and policy documents, Matteo Bettini followed the traces of the pipeline for 13 days. The slow pilgrimage is presented in an audio- video installation that draws on field recordings and archival material. By venturing into the remote areas where these crucial infrastructures reside, the project highlights the need for accidental encounters to witness what has become hidden in plain sight."},
        {id: "impurities", group: "print", category: "m",                           description: "A focus on environmental themes."},
        {id: "xenoplex.org", group: "web-site", category: "v",                      description: "A focus on environmental themes."},
        {id: "Algorithmic Memories", group: "print", category: "v",                 description: "Smartphones, built around increasingly efficient cameras, enable the production of huge amounts of visual media every day. Photography, no longer merely relegated to preserving the past, is now a medium to archive ideas, demonstrate evidence and document everyday moments. Due to the enormous amount of moments collected on our devices, the images we take are managed and organised automatically. Hidden behind simple interfaces, algorithms come into play, silently mediating the creation of future memories every day, choosing which photos to bring out and which to hide. Through machine learning, the contents of every picture taken are extracted and analysed in search of the perfect memory. By examining the influence of algorithms on my personal iOS device, this project reuses the observed curatorship to create new artefacts, with the dual purpose of visualising the impact of the algorithm on memories and proposing an active collaboration between human and machine."},
        {id: "frontieredellatransizione.it", group: "web-site", category: "v",      description: "A digital platform to collect information, spread them and get people informed about the most recent “strategic minerals” research permits released by the italian government. Data are taken from original documents found on website of the national Minister."},
        {id: "Data Fragments", group: 1, category: "m",                             description: "A series of diagrammatic artefacts came to light, seemingly from a distant society - or perhaps a very close one - that used these images to prove and demonstrate its democracy. Mysteriously preserved through time, these boards contain pieces of complex visualisations, etched and drawn from hundreds of open-source datasets. However the fragments lack a legend, employ different units of measurement, and divide space with their own grid. They are accurate charts, yet require contextual interpretation to be fully understood. On display until October 13th 2024 at the Bundeskunsthalle in Bonn. Later in 2025 at SKD in Dresden."},
        
        // {id: "Rotterdam, 3022LG, The Netherlands", group: 1, category: "x",         description: "A focus on environmental themes."},
        // {id: "Nebbiuno, Italy", group: 1, category: "x",                            description: "A focus on environmental themes."},
        // {id: "Questo è un contenuto inutile", group: 1, category: "x",              description: "A focus on environmental themes."},
      ],
      links: [
      {source: "Geography", target: "A great place for a ride", value: 1},
      {source: "Geography", target: "Il signore che viene da lontano", value: 1},
      {source: "Geography", target: "frontieredellatransizione.it", value: 1},
      {source: "Geography", target: "Spitze Ohne Name", value: 1},
      {source: "Geography", target: "The Gas Route", value: 1},
      {source: "Geography", target: "Strategic Futures", value: 1},

      {source: "Ecology", target: "A great place for a ride", value: 1},
      {source: "Ecology", target: "Spitze Ohne Name", value: 1},
      {source: "Ecology", target: "frontieredellatransizione.it", value: 1},
      {source: "Ecology", target: "impurities", value: 1},
      {source: "Ecology", target: "impurities", value: 1},

        {source: "Archive Digging", target: "Strategic Futures", value: 1},
        {source: "Archive Digging", target: "The Gas Route", value: 1},
        {source: "Archive Digging", target: "A cloud of clouds by clouds", value: 1},

        {source: "Diagrams", target: "Data Fragments", value: 1},
        {source: "Diagrams", target: "The Gas Route", value: 1},
        {source: "Diagrams", target: "Spitze Ohne Name", value: 1},

    
      ]
    };

    const width = 928;
    const height = 600;

  // Here's a function that ensures controlled brightness and contrast:  
  function getControlledRandomColor(minLightness = 40, maxLightness = 70, minSaturation = 50, maxSaturation = 100) {
  const hue = Math.floor(Math.random() * 360); // Random hue (0-360 degrees)
  const saturation = Math.floor(Math.random() * (maxSaturation - minSaturation + 1)) + minSaturation; // Controlled saturation
  const lightness = Math.floor(Math.random() * (maxLightness - minLightness + 1)) + minLightness; // Controlled lightness
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}


 // Function to generate a random color
function getRandomColor() {
  const letters = '0123456789ABCDEF';
  let color = '#';
  for (let i = 0; i < 10; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}


// Categories and random color generation
const categories = ["d", "v", "m", "x"];
const categoryColors = {};
categories.forEach(category => {
  categoryColors[category] = getControlledRandomColor(); // Generate color with brightness control
});


// Create the color scale with random colors
const color = d3.scaleOrdinal()
  .domain(categories)
  .range(Object.values(categoryColors));

// Apply "d" category color to body and info-panel
const dCategoryColor = categoryColors["d"];
document.body.style.color = dCategoryColor; // Body background color
document.getElementById("info-panel").style.color = dCategoryColor; // Info-panel background color

// Log the assigned colors (optional for debugging)
console.log("Assigned Colors:", categoryColors);



//forces x visualisation

    const links = data.links.map(d => ({...d}));
    const nodes = data.nodes.map(d => ({...d}));

    const simulation = d3.forceSimulation(nodes)

  .force("link", d3.forceLink(links).id(d => d.id).distance(window.innerWidth < 768 ? 600 : 140))
  .force("charge", d3.forceManyBody().strength(window.innerWidth < 768 ? -100 : -17))
  .force("center", d3.forceCenter(width / 2, height / 2))
  .force("collision", d3.forceCollide().radius(window.innerWidth < 768 ? 20 : 10))
      // .force("link", d3.forceLink(links).id(d => d.id).distance(140))
      // .force("charge", d3.forceManyBody().strength(-17))
      // .force("center", d3.forceCenter(width / 2, height / 2))
      // .force("collision", d3.forceCollide().radius(10))
      // .force("group", d3.forceManyBody().strength(20).distanceMin(5)) // Grouping force
      .on("tick", ticked);
      

        // Add collision to separate nodes and labels
// const labelForce = d3.forceCollide(30); // Adjust radius as needed for spacing
// simulation.force("label-collision", labelForce);

 //SVG
 

    const svg = d3.select("svg");


//infopanel

    const infoPanel = d3.select("#info")
        .style("background-color", "transparent");

        
//imagecontainer

    const imageContainer = d3.select("#images");


//closebutton

    // Initially hide the close button
    d3.select("#close").style("display", "none");

    const closeButton = d3.select("#close") //define closeButton
        // .attr("fill", "color(d.category)")
        .on("click", () => {
        // Hide the node images and the info panel when the close button is clicked
        imageContainer.style("display", "none")
        closeButton.style("display", "none")  // Hide the close button itself
        imageContainer.style("background-color", "transparent)")
        infoPanel.style("display", "none")
        });

//links lines (edges)

    const link = svg.append("g")
      .attr("stroke", "transparent")
      .attr("stroke-opacity", 0.6)
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", d => Math.sqrt(d.value) * 2)
      .attr("stroke-dasharray", ("1, 7"))  // <== This line here!!
      .attr("stroke-linecap", "round");

//nodes

    const node = svg.append("g")
      .attr("stroke", "transparent")
      .attr("stroke-width", 0)
      .selectAll("rect")
      .data(nodes)
      .join("rect")
      .attr("width", 2)
      .attr("height", 2)
      .attr("fill", d => color(d.category))
      .attr("opacity", 0.8)
      .attr("x", d => d.x - 10)
      .attr("y", d => d.y - 10)
      .on("click", (event, d) => {
        infoPanel.html(`<strong>Node</strong><br>${d.id}<br>Type: ${d.group}`);
        displayNodeImages(d.id);  // Display images for the clicked node
        closeButton.style("display", "block")
        imageContainer.style("display", "block")
        imageContainer.style("background-color", "rgba(255, 255, 255, 0.9)");
      });
 
//labels texts

    const labels = svg.append("g")
      .selectAll("text")
      .data(nodes)
      .join("text")
      .attr("x", d => d.x)
      .attr("y", d => d.y - 0)
      .attr("text-anchor", "middle")
      .attr("font-size", d => {
        // Determine base font sizes for each category
        const baseSize = d.category === "x" ? 9 : 19;
        // Adjust based on screen size (smaller screens get larger relative sizes)
        const scaleFactor = window.innerWidth < 768 ? 2.3 : 1; // Increase font size by 1.5x on small screens
        return `${baseSize * scaleFactor}px`})
      .attr("fill", d => color(d.category))
      .attr("font-weight", "regular")
      .attr("font-family", "times")
      .text(d => d.id)
      .attr("data-size", d => d.category === "x" ? "9px" : "19px") // Set data-size attribute
      .on("click", (event, d) => {
        infoPanel.html(`<strong>Node</strong><br>${d.id}<br>Type: ${d.group}`);
        displayNodeImages(d.id);
        closeButton.style("display", "block")
        imageContainer.style("display", "block")
        imageContainer.style("background-color", "rgba(255, 255, 255, 0.9)");
      })
      .call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));

    node.append("title").text(d => d.id);

    //zoom
    const zoom = d3.zoom()
  .scaleExtent([0.5, 3]) // Allow zoom between 50% and 300%
  .on("zoom", (event) => {
    svg.attr("transform", event.transform);
  });


svg.call(zoom);

    function ticked() {
      link.attr("x1", d => d.source.x)
          .attr("y1", d => d.source.y)
          .attr("x2", d => d.target.x)
          .attr("y2", d => d.target.y);

      node.attr("x", d => d.x - 5)
          .attr("y", d => d.y - 5);
      
      labels.attr("x", d => d.x)
            .attr("y", d => d.y - 15);
    }

    node.call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));

    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }

    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    window.addEventListener("resize", () => {
  const isMobile = window.innerWidth < 768;
  simulation.alpha(1).restart(); // Restart simulation with new settings
  simulation.force("link").distance(isMobile ? 100 : 140);
  simulation.force("charge").strength(isMobile ? -10 : -17);
  simulation.force("center", d3.forceCenter(width /1, height / 1));
  simulation.force("collision", d3.forceCollide().radius(window.innerWidth < 768 ? 10 : 10))
});


    //images display

    function displayNodeImages(nodeId) {
  imageContainer.html(""); // Clear previous images


  // Find the clicked node's data
  const nodeData = data.nodes.find(node => node.id === nodeId);

  // Add the description text if it exists
  if (nodeData && nodeData.description) {
    imageContainer.append("p")
      .style("display", "block")
      .style("font-size", "14px")
      .style("margin-bottom", "10px")
      .style("line-height", d => window.innerWidth < 768 ? "1.2em" : "1.3em")
      .text(nodeData.description);
  }

  let imageCount = 1;
  const maxImages = 5;

  while (imageCount <= maxImages) {
    // Check both .jpg and .png formats
    const jpgPath = `img/${nodeId}_${imageCount}.jpg`;
    const pngPath = `img/${nodeId}_${imageCount}.png`;

    // Create and load the .jpg image
    const jpgImg = new Image();
    jpgImg.src = jpgPath;
    jpgImg.classList.add("node-image");

    jpgImg.onerror = () => {}; // Ignore error if .jpg doesn't exist
    jpgImg.onload = () => imageContainer.append(() => jpgImg); // Add .jpg if it loads successfully

    // Create and load the .png image
    const pngImg = new Image();
    pngImg.src = pngPath;
    pngImg.classList.add("node-image");

    pngImg.onerror = () => {}; // Ignore error if .png doesn't exist
    pngImg.onload = () => imageContainer.append(() => pngImg); // Add .png if it loads successfully

    imageCount++;
  }
}
  </script>
</body>
</html>
